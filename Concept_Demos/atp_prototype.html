<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ATP Prototype · Governance Simulation Space</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    :root {
      --bg: #05060b;
      --panel: #0f111a;
      --accent: #7cf0ff;
      --muted: #9aa4c3;
      --border: rgba(255,255,255,0.08);
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Inter', system-ui, -apple-system, sans-serif; background: radial-gradient(circle at 20% 20%, rgba(124,240,255,0.12), transparent 40%), radial-gradient(circle at 80% 0%, rgba(195,145,255,0.16), transparent 36%), var(--bg); color: #e7ecff; }
    main { max-width: 1100px; margin: 0 auto; padding: 32px 18px 48px; }
    h1 { margin: 0 0 12px; letter-spacing: -0.01em; font-size: 32px; }
    p.lead { margin: 0 0 24px; color: var(--muted); max-width: 760px; }
    .grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    .card { background: rgba(255,255,255,0.04); border: 1px solid var(--border); border-radius: 14px; padding: 16px; }
    .section-title { margin: 0 0 10px; font-size: 18px; }
    label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    input, textarea, select { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: rgba(255,255,255,0.04); color: #e7ecff; font-size: 14px; }
    textarea { min-height: 80px; resize: vertical; }
    .row { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }
    button { background: linear-gradient(135deg, #7cf0ff, #5ac8ff); border: none; color: #041019; font-weight: 700; padding: 12px 14px; border-radius: 12px; cursor: pointer; box-shadow: 0 12px 30px -18px #7cf0ff; width: 100%; }
    button:hover { filter: brightness(1.04); }
    .pill { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background: rgba(255,255,255,0.05); border:1px solid var(--border); color: var(--muted); font-size: 12px; }
    .log { list-style:none; padding:0; margin:0; display:grid; gap:10px; }
    .log li { padding:10px 12px; border-radius:10px; border:1px solid var(--border); background: rgba(255,255,255,0.03); }
    .muted { color: var(--muted); font-size: 13px; }
    code { background: rgba(255,255,255,0.06); padding: 2px 5px; border-radius: 6px; }
    .badge { display:inline-flex; gap:6px; align-items:center; padding:4px 8px; border-radius:8px; border:1px solid var(--border); font-size:12px; color: var(--muted); }
  </style>
</head>
<body>
  <main>
    <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap;">
      <div>
        <h1>ATP Prototype</h1>
        <p class="lead">Build structured Artemis Transmission Protocol (ATP) messages, route them to agents, and observe trust-aware outcomes. Future features (Hebbian routing, telemetry overlays) are gated out in this demo build.</p>
      </div>
      <div class="pill"><span style="width:8px;height:8px;border-radius:50%;background:var(--accent);box-shadow:0 0 12px var(--accent);"></span>Static client-side demo</div>
    </div>
    <div id="app"></div>
  </main>

  <script type="text/babel">
    const { useState, useMemo } = React;

    const AGENTS = {
      artemis: { name: 'Artemis (Governance)', strengths: ['policy','review'], trust: 0.92 },
      packrat: { name: 'Pack Rat (Ops)', strengths: ['delivery','ops'], trust: 0.78 },
      copilot: { name: 'Copilot (Assistant)', strengths: ['build','ideation'], trust: 0.73 },
      daemon: { name: 'Codex Daemon (Memory)', strengths: ['context','memory'], trust: 0.81 }
    };

    const scoreRoute = (mode, priority, action, context) => {
      const keywords = context.toLowerCase();
      const base = Object.entries(AGENTS).map(([id, agent]) => {
        let score = agent.trust * 0.6;
        if (keywords.includes('policy') || mode === 'Review') score += 0.2 * (id === 'artemis');
        if (keywords.includes('memory') || keywords.includes('context')) score += 0.2 * (id === 'daemon');
        if (keywords.includes('deliver') || keywords.includes('ops')) score += 0.2 * (id === 'packrat');
        if (mode === 'Build' || action === 'Implement') score += 0.15 * (id === 'copilot');
        if (priority === 'High') score += 0.05;
        return { id, score };
      });
      return base.sort((a,b)=>b.score-a.score);
    };

    const RouteCard = ({ route }) => {
      if (!route) return <p className="muted">No messages routed yet.</p>;
      return (
        <div style={{border:'1px solid var(--border)',borderRadius:12,padding:'12px',background:'rgba(255,255,255,0.02)'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:6}}>
            <strong>{route.primary.name}</strong>
            <span className="badge">Score {route.primary.score.toFixed(2)}</span>
          </div>
          <p className="muted" style={{margin:'4px 0 8px'}}>Backup: {route.secondary.name} (score {route.secondary.score.toFixed(2)})</p>
          <div style={{display:'grid',gap:'6px'}}>
            <div className="badge">Mode: {route.mode}</div>
            <div className="badge">Priority: {route.priority}</div>
            <div className="badge">Action: {route.action}</div>
          </div>
        </div>
      );
    };

    const Compose = ({ onSend }) => {
      const [mode, setMode] = useState('Build');
      const [priority, setPriority] = useState('High');
      const [action, setAction] = useState('Plan');
      const [context, setContext] = useState('Implement postal routing health check');
      const [content, setContent] = useState('Add heartbeat check for Pack Rat postal service.');

      return (
        <section className="card">
          <h2 className="section-title">Compose ATP message</h2>
          <div className="row">
            <div>
              <label>Mode</label>
              <select value={mode} onChange={e=>setMode(e.target.value)}>
                <option>Build</option>
                <option>Review</option>
                <option>Execute</option>
                <option>Explore</option>
              </select>
            </div>
            <div>
              <label>Priority</label>
              <select value={priority} onChange={e=>setPriority(e.target.value)}>
                <option>High</option>
                <option>Normal</option>
                <option>Low</option>
              </select>
            </div>
            <div>
              <label>Action Type</label>
              <select value={action} onChange={e=>setAction(e.target.value)}>
                <option>Plan</option>
                <option>Implement</option>
                <option>Validate</option>
              </select>
            </div>
          </div>
          <label style={{marginTop:10}}>Context</label>
          <input value={context} onChange={e=>setContext(e.target.value)} />
          <label style={{marginTop:10}}>Content</label>
          <textarea value={content} onChange={e=>setContent(e.target.value)} />
          <button style={{marginTop:12}} onClick={()=>onSend({mode,priority,action,context,content})}>Route message</button>
          <p className="muted" style={{marginTop:10}}>Headers are parsed client-side; routing weights are deterministic for this demo build.</p>
        </section>
      );
    };

    const App = () => {
      const [routes, setRoutes] = useState([]);

      const lastRoute = routes[0];
      const avgTrust = useMemo(() => {
        if (!routes.length) return 0;
        return routes.reduce((acc,r)=>acc + r.primary.trust, 0) / routes.length;
      }, [routes]);

      const handleSend = ({mode,priority,action,context,content}) => {
        const scored = scoreRoute(mode, priority, action, `${context} ${content}`);
        const [first, second] = scored;
        const route = {
          mode, priority, action, context, content,
          primary: { ...AGENTS[first.id], id:first.id, score:first.score },
          secondary: { ...AGENTS[second.id], id:second.id, score:second.score }
        };
        setRoutes(prev => [route, ...prev.slice(0, 19)]);
      };

      return (
        <>
          <div className="grid">
            <Compose onSend={handleSend} />
            <section className="card">
              <h2 className="section-title">Routing result</h2>
              <RouteCard route={lastRoute} />
              <div style={{marginTop:'12px', display:'flex', gap:'8px', flexWrap:'wrap'}}>
                {Object.entries(AGENTS).map(([id,a]) => (
                  <span key={id} className="badge">{a.name} · trust {a.trust.toFixed(2)}</span>
                ))}
              </div>
            </section>
          </div>

          <section className="card" style={{marginTop:16}}>
            <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:8}}>
              <h2 className="section-title" style={{margin:0}}>Activity log</h2>
              <span className="badge">{routes.length} routed · avg trust {avgTrust.toFixed(2)}</span>
            </div>
            <ul className="log">
              {routes.length === 0 && <li className="muted">No activity yet. Compose an ATP message to see routing.</li>}
              {routes.map((r, idx) => (
                <li key={idx}>
                  <div style={{display:'flex',justifyContent:'space-between',gap:'8px',flexWrap:'wrap'}}>
                    <strong>{r.primary.name}</strong>
                    <span className="muted">{r.mode} · {r.priority} · {r.action}</span>
                  </div>
                  <div className="muted" style={{marginTop:4}}>{r.context || 'No context provided'}</div>
                </li>
              ))}
            </ul>
          </section>
        </>
      );
    };

    ReactDOM.createRoot(document.getElementById('app')).render(<App />);
  </script>
</body>
</html>
